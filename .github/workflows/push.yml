on: push
name: on push
jobs:
  Tests:
    name: base
    strategy:
      matrix:
        python:
           - '2.7'
           - '3.5'
           - '3.6'
           - '3.7'
        java:
          - '8'
          - '9'
          - '10'
          # - '11'  # seems to segfault in python3.7?
        os:
          - 'ubuntu-latest'
          # - 'windows-latest' # doesn't work yet because VS c++14 is not found
        architecture:
          - 'x64'
          - 'x86'

    runs-on: ${{ matrix.os }}
    steps:
    - uses: actions/checkout@master

    - name: Setup python
      uses: actions/setup-python@v1
      with:
        python-version: ${{ matrix.python }}

    - name: Setup java
      uses: actions/setup-java@v1
      with:
        java-version: ${{ matrix.java }}
        architecture: ${{ matrix.architecture }} # x64 // (x64 or x86) - defaults to x64

    - name: install
      run: |
        pip install -U setuptools
        pip install .[dev,ci]

    - name: test
      run: |
        ant all
        cd tests
        CLASSPATH=../build/test-classes:../build/classes nosetests -v

#     - name: coveralls
#       run: python -m coveralls
#       env:
#         COVERALLS_REPO_TOKEN: ${{ secrets.COVERALLS_REPO_TOKEN }}

  TestsMacOs:
    name: test OSX
    runs-on: macOs-latest

    strategy:
      matrix:
        java:
          - '8'
          - '9'
          - '10'
          - '11'

    steps:
    - uses: actions/checkout@master

    - name: Setup java
      uses: actions/setup-java@v1
      with:
        java-version: ${{ matrix.java }}

    - name: install
      run: |
        brew install ant
        pip install --user -U setuptools
        pip install --user .[dev,ci]

    - name: test
      run: |
        ant all
        cd tests
          CLASSPATH=../build/test-classes:../build/classes nosetests -v

    - name: test
      run: |
        ant all
        cd tests
        CLASSPATH=../build/test-classes:../build/classes nosetests -v
